<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="controllers.StudentController"
            style="-fx-background-color: #f5f5f5;">

    <!-- TOP HEADER -->
    <top>
        <VBox spacing="0">
            <!-- Title Bar -->
            <VBox style="-fx-background-color: #2c3e50; -fx-padding: 20; -fx-spacing: 10;">
                <HBox alignment="CENTER_LEFT" spacing="20">
                    <Label fx:id="welcomeLabel"
                           text="Welcome, Student!"
                           style="-fx-text-fill: white; -fx-font-size: 20px; -fx-font-weight: bold;"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button onAction="#openChatbot"
                            style="-fx-background-color: #1f2933; -fx-text-fill: white;
                                   -fx-font-size: 13px; -fx-padding: 6 18; -fx-background-radius: 4;">
                        <graphic>
                            <Label text="ðŸ¤– " style="-fx-font-size: 12px;"/>
                        </graphic>
                        <text>AI Assistant</text>
                    </Button>
                </HBox>
                <Label text="Submit tickets, track requests, and find solutions"
                       style="-fx-text-fill: #bdc3c7; -fx-font-size: 14px;"/>
            </VBox>

            <!-- NAV TABS -->
            <VBox style="-fx-background-color: #f5f5f5; -fx-padding: 0 20 0 20;">
                <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-padding: 15 0;">
                    <Button text="My Tickets" onAction="#showMyTickets"
                            style="-fx-background-radius: 20; -fx-background-color: #ffffff;
                                   -fx-border-color: #d0d0d0; -fx-border-radius: 20;
                                   -fx-padding: 4 16; -fx-font-size: 12px; -fx-cursor: hand;"/>
                    <Button text="Submit Ticket" onAction="#showSubmitTicket"
                            style="-fx-background-radius: 20; -fx-background-color: #ffffff;
                                   -fx-border-color: #d0d0d0; -fx-border-radius: 20;
                                   -fx-padding: 4 16; -fx-font-size: 12px; -fx-cursor: hand;"/>
                    <Button text="FAQ" onAction="#showFaq"
                            style="-fx-background-radius: 20; -fx-background-color: #ffffff;
                                   -fx-border-color: #d0d0d0; -fx-border-radius: 20;
                                   -fx-padding: 4 16; -fx-font-size: 12px; -fx-cursor: hand;"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button text="Logout" onAction="#handleLogout"
                            style="-fx-background-radius: 20; -fx-background-color: #ffffff;
                                   -fx-border-color: #d0d0d0; -fx-border-radius: 20;
                                   -fx-padding: 4 16; -fx-font-size: 12px; -fx-cursor: hand;"/>
                </HBox>
            </VBox>
        </VBox>
    </top>

    <!-- CENTER CONTENT -->
    <center>
        <HBox spacing="20" style="-fx-padding: 30;" BorderPane.alignment="CENTER">

            <!-- LEFT: main content takes all remaining width -->
            <StackPane fx:id="contentArea" HBox.hgrow="ALWAYS">

                <!-- MY TICKETS VIEW -->
                <VBox fx:id="myTicketsContent" spacing="20" visible="true">
                    <HBox alignment="CENTER_LEFT">
                        <Label text="My Support Tickets"
                               style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label fx:id="ticketCountLabel"
                               text="0 total tickets"
                               style="-fx-text-fill: #7f8c8d;"/>
                    </HBox>

                    <ScrollPane fitToWidth="true"
                                style="-fx-background-color: transparent; -fx-border-color: transparent;">
                        <VBox fx:id="ticketsListContainer"
                              spacing="12"
                              style="-fx-padding: 0;"/>
                    </ScrollPane>
                </VBox>

                <!-- SUBMIT TICKET VIEW (SCROLLABLE, HIDDEN BY DEFAULT) -->
                <ScrollPane fx:id="submitTicketScroll" fitToWidth="true" visible="false" managed="false"
                            style="-fx-background-color: transparent; -fx-border-color: transparent;">
                    <content>
                        <VBox fx:id="submitTicketContent" spacing="20" style="-fx-padding: 20;">
                            <Label text="Submit a Support Ticket"
                                   style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                            <Label text="Describe your issue and our team will assist you"
                                   style="-fx-text-fill: #7f8c8d; -fx-font-size: 12px;"/>

                            <VBox spacing="15"
                                  style="-fx-background-color: white; -fx-padding: 20;
                                         -fx-background-radius: 12; -fx-border-color: #e0e0e0;
                                         -fx-border-radius: 12;">

                                <Label text="Ticket Information"
                                       style="-fx-font-weight: bold; -fx-font-size: 14px;"/>
                                <Label text="Provide detailed information to help us resolve your issue quickly"
                                       style="-fx-text-fill: #7f8c8d; -fx-font-size: 11px;"/>

                                <!-- Title -->
                                <VBox spacing="5">
                                    <Label text="Issue Title *"
                                           style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                    <TextField fx:id="ticketTitleField"
                                               promptText="Brief description of your issue"
                                               style="-fx-padding: 10; -fx-font-size: 12px;"/>
                                </VBox>

                                <!-- Description -->
                                <VBox spacing="5">
                                    <Label text="Detailed Description *"
                                           style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                    <TextArea fx:id="ticketDescField"
                                              promptText="Please describe your issue in detail. Include any error messages, steps to reproduce, or relevant information..."
                                              wrapText="true"
                                              style="-fx-padding: 10; -fx-font-size: 12; -fx-control-inner-background: #f9f9f9;"
                                              prefHeight="120"/>
                                </VBox>

                                <!-- Category & Priority Row -->
                                <HBox spacing="20">
                                    <VBox spacing="5" HBox.hgrow="ALWAYS">
                                        <Label text="Category *"
                                               style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                        <ComboBox fx:id="categoryCombo"
                                                  promptText="Select category"
                                                  style="-fx-padding: 8;"/>
                                    </VBox>
                                    <VBox spacing="5" HBox.hgrow="ALWAYS">
                                        <Label text="Priority *"
                                               style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                        <ComboBox fx:id="priorityCombo"
                                                  promptText="Select priority"
                                                  style="-fx-padding: 8;"/>
                                    </VBox>
                                </HBox>

                                <!-- Attachments -->
                                <VBox spacing="5">
                                    <Label text="Attachments (Optional)"
                                           style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                    <HBox spacing="10">
                                        <Button fx:id="uploadFilesButton"
                                                text="â¬† Upload Files"
                                                onAction="#handleUploadFiles"
                                                style="-fx-background-color: #ffffff; -fx-border-color: #d0d0d0;
                                                       -fx-border-radius: 6; -fx-background-radius: 6;
                                                       -fx-padding: 8 16; -fx-font-size: 12px;"/>
                                        <Label text="Images, screenshots, or documents"
                                               style="-fx-text-fill: #7f8c8d; -fx-font-size: 11px;"/>
                                    </HBox>
                                    <HBox fx:id="attachmentsContainer" spacing="6"/>
                                </VBox>

                                <!-- Info Box -->
                                <VBox spacing="8"
                                      style="-fx-background-color: #f9f9f9; -fx-padding: 15; -fx-background-radius: 8;">
                                    <Label text="Your ticket will be:"
                                           style="-fx-font-weight: bold; -fx-font-size: 12px;"/>
                                    <Label text="â€¢ Automatically classified and prioritized"
                                           style="-fx-font-size: 11px;"/>
                                    <Label text="â€¢ Assigned to the appropriate support team"
                                           style="-fx-font-size: 11px;"/>
                                    <Label text="â€¢ Tracked with SLA monitoring"
                                           style="-fx-font-size: 11px;"/>
                                    <Label text="â€¢ Updated with real-time status notifications"
                                           style="-fx-font-size: 11px;"/>
                                </VBox>

                                <!-- Submit Button -->
                                <Button fx:id="submitTicketButton" text="Submit Ticket" onAction="#submitTicket"
                                        style="-fx-background-color: #5a6c7d; -fx-text-fill: white; -fx-padding: 12 30;
                                               -fx-font-size: 13px; -fx-background-radius: 6; -fx-cursor: hand;"
                                        prefWidth="Infinity"/>
                            </VBox>
                        </VBox>
                    </content>
                </ScrollPane>

                <!-- FAQ VIEW (SCROLLABLE, HIDDEN BY DEFAULT) -->
                <ScrollPane fx:id="faqContentScroll"
                            fitToWidth="true"
                            visible="false"
                            managed="false"
                            style="-fx-background-color: transparent; -fx-border-color: transparent;">
                    <content>
                        <VBox fx:id="faqContent" spacing="20" style="-fx-padding: 20;">
                            <Label text="FAQ" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                            <Label text="Search for guides, FAQs, and solutions"
                                   style="-fx-text-fill: #7f8c8d; -fx-font-size: 12px;"/>

                            <TextField fx:id="faqSearchField"
                                       promptText="Search for help articles..."
                                       onKeyReleased="#filterFaq"
                                       style="-fx-padding: 10; -fx-font-size: 12px; -fx-background-color: #f9f9f9;
                                              -fx-border-color: #e0e0e0; -fx-border-radius: 6;"/>

                            <ScrollPane fitToWidth="true"
                                        style="-fx-background-color: transparent; -fx-border-color: transparent;">
                                <VBox fx:id="faqListContainer" spacing="12"/>
                            </ScrollPane>
                        </VBox>
                    </content>
                </ScrollPane>

                <!-- TICKET DETAILS OVERLAY (HIDDEN BY DEFAULT) -->
                <BorderPane fx:id="ticketDetailsOverlay"
                            visible="false" managed="false"
                            style="-fx-background-color: rgba(0,0,0,0.45);">
                    <center>
                        <VBox fx:id="ticketDetailsCard"
                              spacing="10"
                              style="-fx-background-color: white; -fx-padding: 20;
                                     -fx-background-radius: 10; -fx-max-width: 700;"
                              BorderPane.alignment="CENTER">
                            <!-- Header -->
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label fx:id="detailsTitleLabel"
                                       text="Cannot access email account"
                                       style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="âœ•" onAction="#closeTicketDetails"
                                        style="-fx-background-color: transparent; -fx-font-size: 14px;"/>
                            </HBox>
                            <Label fx:id="detailsTicketIdLabel"
                                   text="Ticket #1"
                                   style="-fx-text-fill: #6b7280; -fx-font-size: 11px;"/>

                            <!-- Badges -->
                            <HBox spacing="6">
                                <Label fx:id="detailsStatusBadge"
                                       text="in-progress"
                                       style="-fx-background-color: #e0d9ff; -fx-text-fill: #4b3f72;
                                              -fx-padding: 3 8; -fx-background-radius: 999; -fx-font-size: 11px;"/>
                                <Label fx:id="detailsPriorityBadge"
                                       text="high"
                                       style="-fx-background-color: #ffe5b4; -fx-text-fill: #92400e;
                                              -fx-padding: 3 8; -fx-background-radius: 999; -fx-font-size: 11px;"/>
                            </HBox>

                            <!-- Description -->
                            <Label text="Description"
                                   style="-fx-font-weight: bold; -fx-font-size: 12px;"/>
                            <Label fx:id="detailsDescriptionLabel"
                                   wrapText="true"
                                   style="-fx-font-size: 12px; -fx-text-fill: #374151;"/>

                            <!-- Info grid -->
                            <HBox spacing="40">
                                <VBox spacing="4">
                                    <Label text="Category:"
                                           style="-fx-font-size: 11px; -fx-text-fill: #6b7280;"/>
                                    <Label fx:id="detailsCategoryLabel"
                                           style="-fx-font-size: 12px;"/>
                                    <Label text="Created:"
                                           style="-fx-font-size: 11px; -fx-text-fill: #6b7280;"/>
                                    <Label fx:id="detailsCreatedLabel"
                                           style="-fx-font-size: 12px;"/>
                                </VBox>
                                <VBox spacing="4">
                                    <Label text="Channel:"
                                           style="-fx-font-size: 11px; -fx-text-fill: #6b7280;"/>
                                    <Label fx:id="detailsChannelLabel"
                                           text="Web"
                                           style="-fx-font-size: 12px;"/>
                                    <Label text="Last Updated:"
                                           style="-fx-font-size: 11px; -fx-text-fill: #6b7280;"/>
                                    <Label fx:id="detailsUpdatedLabel"
                                           style="-fx-font-size: 12px;"/>
                                </VBox>
                            </HBox>

                            <!-- Assigned to -->
                            <VBox spacing="2">
                                <Label text="Assigned To"
                                       style="-fx-font-weight: bold; -fx-font-size: 12px;"/>
                                <Label fx:id="detailsAssignedToLabel"
                                       style="-fx-font-size: 12px;"/>
                            </VBox>

                            <!-- Suggested Solutions -->
                            <VBox spacing="4">
                                <Label text="Suggested Solutions"
                                       style="-fx-font-weight: bold; -fx-font-size: 12px;"/>
                                <Hyperlink text="How to Reset Your Password"/>
                                <Hyperlink text="Email Setup on Mobile Device"/>
                            </VBox>
                        </VBox>
                    </center>
                </BorderPane>

            </StackPane>

            <!-- RIGHT: chatbot container fixed width -->
            <VBox fx:id="chatbotContainer"
                  prefWidth="320"
                  minWidth="320"
                  maxWidth="320"
                  visible="false"
                  managed="false">
                <fx:include source="chatbot-panel.fxml"/>
            </VBox>

        </HBox>
    </center>
</BorderPane>
